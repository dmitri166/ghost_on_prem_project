apiVersion: v1
kind: ConfigMapList
metadata:
  name: ghost-app-dashboards
  namespace: monitoring
items:
- metadata:
    name: ghost-app-overview
    namespace: monitoring
    labels:
      grafana_dashboard: "1"
  data:
    ghost-app-overview.json: |
      {
        "dashboard": {
          "id": null,
          "title": "Ghost Application Overview",
          "tags": ["ghost", "application"],
          "timezone": "browser",
          "panels": [
            {
              "id": 1,
              "title": "Request Rate",
              "type": "graph",
              "targets": [
                {
                  "expr": "rate(http_requests_total{job=\"ghost-app\"}[5m])",
                  "legendFormat": "{{method}} {{status}}"
                }
              ],
              "yAxes": [
                {
                  "label": "Requests/sec"
                }
              ]
            },
            {
              "id": 2,
              "title": "Response Time",
              "type": "graph",
              "targets": [
                {
                  "expr": "histogram_quantile(0.50, rate(http_request_duration_seconds_bucket{job=\"ghost-app\"}[5m]))",
                  "legendFormat": "50th percentile"
                },
                {
                  "expr": "histogram_quantile(0.95, rate(http_request_duration_seconds_bucket{job=\"ghost-app\"}[5m]))",
                  "legendFormat": "95th percentile"
                },
                {
                  "expr": "histogram_quantile(0.99, rate(http_request_duration_seconds_bucket{job=\"ghost-app\"}[5m]))",
                  "legendFormat": "99th percentile"
                }
              ],
              "yAxes": [
                {
                  "label": "Seconds"
                }
              ]
            },
            {
              "id": 3,
              "title": "Error Rate",
              "type": "graph",
              "targets": [
                {
                  "expr": "rate(http_requests_total{job=\"ghost-app\",status=~\"4..\"}[5m])",
                  "legendFormat": "4xx errors"
                },
                {
                  "expr": "rate(http_requests_total{job=\"ghost-app\",status=~\"5..\"}[5m])",
                  "legendFormat": "5xx errors"
                }
              ],
              "yAxes": [
                {
                  "label": "Errors/sec"
                }
              ]
            },
            {
              "id": 4,
              "title": "Application Status",
              "type": "stat",
              "targets": [
                {
                  "expr": "up{job=\"ghost-app\"}",
                  "legendFormat": "{{instance}}"
                }
              ],
              "fieldConfig": {
                "defaults": {
                  "mappings": [
                    {
                      "options": {
                        "0": {
                          "text": "DOWN",
                          "color": "red"
                        },
                        "1": {
                          "text": "UP",
                          "color": "green"
                        }
                      },
                      "type": "value"
                    }
                  ]
                }
              }
            }
          ],
          "time": {
            "from": "now-1h",
            "to": "now"
          },
          "refresh": "30s"
        }
      }
- metadata:
    name: ghost-infrastructure
    namespace: monitoring
    labels:
      grafana_dashboard: "1"
  data:
    ghost-infrastructure.json: |
      {
        "dashboard": {
          "id": null,
          "title": "Ghost Infrastructure",
          "tags": ["ghost", "infrastructure"],
          "timezone": "browser",
          "panels": [
            {
              "id": 1,
              "title": "CPU Usage",
              "type": "graph",
              "targets": [
                {
                  "expr": "rate(container_cpu_usage_seconds_total{pod=~\"ghost-app-.*\"}[5m])",
                  "legendFormat": "{{pod}}"
                }
              ],
              "yAxes": [
                {
                  "label": "CPU Cores",
                  "max": 1
                }
              ]
            },
            {
              "id": 2,
              "title": "Memory Usage",
              "type": "graph",
              "targets": [
                {
                  "expr": "container_memory_usage_bytes{pod=~\"ghost-app-.*\"} / 1024 / 1024",
                  "legendFormat": "{{pod}}"
                }
              ],
              "yAxes": [
                {
                  "label": "Memory (MB)"
                }
              ]
            },
            {
              "id": 3,
              "title": "Database Connections",
              "type": "graph",
              "targets": [
                {
                  "expr": "mysql_global_status_threads_connected",
                  "legendFormat": "Active Connections"
                },
                {
                  "expr": "mysql_global_variables_max_connections",
                  "legendFormat": "Max Connections"
                }
              ],
              "yAxes": [
                {
                  "label": "Connections"
                }
              ]
            },
            {
              "id": 4,
              "title": "Node Disk Usage",
              "type": "graph",
              "targets": [
                {
                  "expr": "(node_filesystem_size_bytes - node_filesystem_free_bytes) / node_filesystem_size_bytes * 100",
                  "legendFormat": "{{instance}} {{mountpoint}}"
                }
              ],
              "yAxes": [
                {
                  "label": "Usage (%)",
                  "max": 100,
                  "min": 0
                }
              ]
            }
          ],
          "time": {
            "from": "now-1h",
            "to": "now"
          },
          "refresh": "30s"
        }
      }
